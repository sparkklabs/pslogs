"use strict";var S=require("pm2"),g=/(?:status|code)[\s:=]*(\d{3})[^\d]/gmi,u=[404,500],a,p,l="";function O(n){f(n),_()}function f([n,t="silent app"]){a=n,p=t}function _(){S.connect(n=>{if(n)return r(n);S.launchBus((t,s)=>{if(t)return r(t);i("INFO","internal","\u{1F3A7} STREAM PM2 CONNECTED."),s.on("log:err",d)})})}function d({process:n,data:t}){if(!t)return;let s=typeof t=="string"?t:JSON.stringify(t);if(s===l)return;let o=[],c;for(;c=g.exec(s);){let e=parseInt(c[1],10);isNaN(e)||o.includes(e)||o.push(e)}switch(o.length){case 0:break;case 1:{let e=o[0];if(u.includes(e)){e>499&&e<600&&i(e,n.name,s);break}}default:i("UNKNOWN ERROR",n.name,`{STATUS CODES: ${JSON.stringify(o)}} ~ ${s}`)}l=s}function i(n,t,s){fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attachments:[{type:"mrkdwn",color:"#27AE61",text:`*PSLOGS ~ ${t} &lt;${p}&gt; [${n}]:*`},{type:"mrkdwn",color:n==="INFO"?"#F7D488":"#FF4365",text:`\`\`\`${s}\`\`\``}]})}).catch(r)}function T(...n){O(n)}function r(n){console.error("<PSLOGS> [ERROR]:",n),process.exit(2)}module.exports={run:T};
