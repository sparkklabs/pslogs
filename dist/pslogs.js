"use strict";var l=require("pm2"),a=/(?:status|code)[\s:=]*(\d{3})[^\d]/gmi,S=[404,500],g,u="";function f(n){O(n),d()}function O(n){g=n}function d(){l.connect(n=>{if(n)return r(n);l.launchBus((t,s)=>{if(t)return r(t);i("INFO","internal","\u{1F3A7} STREAM PM2 CONNECTED."),s.on("log:err",p)})})}function p({process:n,data:t}){if(!t)return;let s=typeof t=="string"?t:JSON.stringify(t);if(s===u)return;let e=[],c;for(;c=a.exec(s);){let o=parseInt(c[1],10);isNaN(o)||e.includes(o)||e.push(o)}switch(e.length){case 0:break;case 1:{let o=e[0];if(S.includes(o)){o>499&&o<600&&i(o,n.name,s);break}}default:i("UNKNOWN ERROR",n.name,`{STATUS CODES: ${JSON.stringify(e)}} ~ ${s}`)}u=s}function i(n,t,s){fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attachments:[{type:"mrkdwn",color:"#27AE61",text:`*&lt;PSLOGS ~ ${t}&gt; [${n}]:*`},{type:"mrkdwn",color:n==="INFO"?"#F7D488":"#FF4365",text:`\`\`\`${s}\`\`\``}]})}).catch(r)}function E(n){f(n)}function r(n){console.error("<PSLOGS> [ERROR]:",n),process.exit(2)}module.exports={run:E};
